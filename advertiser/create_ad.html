<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>إنشاء حملة إعلانية - AdGain Pro</title>
    <link rel="stylesheet" href="../css/style.css"> 
    <style>
        .container { max-width: 800px; }
        .cost-summary { 
            background-color: #f7f9fb; 
            padding: 15px; 
            border-radius: 6px; 
            margin-top: 20px;
            border: 1px solid #ddd;
        }
    </style>
</head>
<body>
    <header>
        <nav>
            <a href="dashboard.html" class="logo">لوحة تحكم المعلنين</a>
            <ul>
                <li><a href="create_ad.html">إنشاء حملة</a></li>
                <li><a href="#" id="logoutBtn">تسجيل الخروج</a></li>
            </ul>
        </nav>
    </header>

    <div class="container">
        <div class="card">
            <h2>إطلاق حملة إعلانية جديدة</h2>
            <p>رصيدك الحالي: <strong id="advertiserBalance">جاري التحميل...</strong> د.ج</p>
            <div id="message" class="alert" style="display: none;"></div>

            <form id="createAdForm">
                <h3>تفاصيل الإعلان</h3>

                <label for="title">عنوان الإعلان (ما سيراه المستخدم):</label>
                <input type="text" id="title" required placeholder="مثال: شاهد منتجاتنا الجديدة">

                <label for="url">رابط الإعلان (يجب أن يبدأ بـ http:// أو https://):</label>
                <input type="url" id="url" required placeholder="مثال: https://yourcompany.com">

                <label for="viewDuration">مدة المشاهدة المطلوبة (بالثواني):</label>
                <input type="number" id="viewDuration" min="5" max="60" value="15" required>
                
                <hr style="margin: 20px 0;">

                <h3>إعدادات الميزانية</h3>

                <label for="rewardAmount">مكافأة المستخدم لكل مشاهدة (يدفعها الموقع للمستخدم):</label>
                <input type="number" id="rewardAmount" min="1" step="1" required placeholder="بالدينار الجزائري (مثال: 10.00)">

                <label for="totalViews">إجمالي عدد المشاهدات التي ترغب في شرائها:</label>
                <input type="number" id="totalViews" min="100" step="10" required placeholder="الحد الأدنى 100 مشاهدة">

                <div class="cost-summary">
                    <h4>ملخص التكلفة (تقديري)</h4>
                    <p>تكلفة الشراء لكل مشاهدة (تشمل ربح الموقع): <strong id="costPerView">0.00</strong> د.ج</p>
                    <p>التكلفة الإجمالية للحملة: <strong id="totalCost">0.00</strong> د.ج</p>
                    <p style="color: red; font-weight: bold;">يجب أن يكون رصيدك كافياً لتغطية التكلفة الإجمالية.</p>
                </div>

                <button type="submit" class="btn btn-success" style="margin-top: 20px;">إطلاق الحملة الآن</button>
            </form>
        </div>
    </div>

    <script src="../js/advertiser.js"></script>
    <script>
        // نسبة الربح للمالك (20%) - يجب أن تتطابق مع منطق الـ Backend
        const OWNER_PROFIT_MARGIN = 1.2; 

        document.addEventListener('DOMContentLoaded', () => {
            // التحقق من صلاحية المعلن عند تحميل الصفحة
            checkAdvertiserAuth();
            
            const rewardInput = document.getElementById('rewardAmount');
            const viewsInput = document.getElementById('totalViews');

            // دالة تحديث الملخص
            const updateSummary = () => {
                const reward = parseFloat(rewardInput.value) || 0;
                const views = parseInt(viewsInput.value) || 0;

                const costPerView = reward * OWNER_PROFIT_MARGIN;
                const totalCost = views * costPerView;

                document.getElementById('costPerView').textContent = `${costPerView.toFixed(2)} د.ج`;
                document.getElementById('totalCost').textContent = `${totalCost.toFixed(2)} د.ج`;
            };

            rewardInput.addEventListener('input', updateSummary);
            viewsInput.addEventListener('input', updateSummary);
            
            // جلب رصيد المعلن عند تحميل الصفحة (وظيفة يجب توفيرها في advertiser.js)
            fetchAdvertiserData();

            // إرسال النموذج
            document.getElementById('createAdForm').addEventListener('submit', (e) => {
                e.preventDefault();
                const adData = {
                    title: document.getElementById('title').value,
                    url: document.getElementById('url').value,
                    viewDuration: parseInt(document.getElementById('viewDuration').value),
                    rewardAmount: parseFloat(rewardInput.value),
                    totalViews: parseInt(viewsInput.value),
                };
                createAdCampaign(adData);
            });
        });
    </script>
</body>
</html>